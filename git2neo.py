import pandas as pd
from py2neo import Graph

import query_cve_repos
import private_config
import config

if __name__ == '__main__':
    NUM_OF_CVE_REPOS_TO_CRAWL = 10
    run_first_time = False

    my_graph = Graph(config.neo4j['endpoint'], name=config.neo4j['db_name'], user=config.neo4j['user_name'], password=config.neo4j['password'])
    if (run_first_time):
        my_graph.delete_all()
        # # Uncomment when refreshing database constraints
        # my_graph.schema.create_uniqueness_constraint('Repo', 'name')
        # my_graph.schema.create_uniqueness_constraint('Person', 'username')

    my_token = private_config.github_token
    repos_df = pd.read_csv('owner_repo.csv')
    sub_repos_df = repos_df.iloc[0:NUM_OF_CVE_REPOS_TO_CRAWL]

    # query_cve_repos.gitquery_stargazers_by_cve_repos(my_graph, sub_repos_df, my_token, limit_stargazers_per_repo_query=1000)
    query_cve_repos.gitquery_l1_repos(my_graph, my_token, limit_users = 10, limit_repos_per_user=10, limit_stargazers_per_repo_query=1000)


    ## Production size
    # query_cve_repos.gitquery_stargazers_by_cve_repos(my_graph, sub_repos_df, my_token, limit_stargazers_per_repo_query=15000)
    # query_cve_repos.gitquery_l1_repos(my_graph, my_token, limit_users=100, limit_repos_per_user=100, limit_stargazers_per_repo_query=15000)

