from py2neo import Graph, Node, Relationship


def query_most_cve_starred_users(neo4j_graph, limit_users):
    cypher_query = '''
        MATCH (n)-[s:STARRED]->(r:Repo) 
        RETURN n, count(s) AS repos_starred 
        ORDER BY repos_starred desc 
        LIMIT $limit_users_param
    '''
    user_nodes = neo4j_graph.run(cypher_query, parameters={'limit_users_param': limit_users}).data()
    users = [x['n']['username'] for x in user_nodes]
    return users